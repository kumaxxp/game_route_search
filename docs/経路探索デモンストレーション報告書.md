# 経路探索デモンストレーション報告書

**報告日時**: 2026年1月29日
**報告者**: 師団長（Claude Code）
**視察官**: 大本営

---

## 1. 演習概要

### 1.1 演習条件

| 項目 | 内容 |
|:---|:---|
| マップサイズ | 10×10 Isometricグリッド |
| 始点 | (0, 0) |
| 終点 | (9, 9) |
| 障害物 | 水辺（高コスト）、崖（高度差+超高コスト） |

### 1.2 地形配置

```
【地形レイヤー】
      0 1 2 3 4 5 6 7 8 9
    +---------------------+
  0 | S . . . F F . . . . |
  1 | . . . . F F . . . . |
  2 | . . ~ ~ ~ ~ ~ ~ . . |  ← 水辺帯
  3 | . . ~ ~ ~ ~ ~ ~ . . |  ← 水辺帯
  4 | . . ^ ^ ^ ^ ^ ^ . . |  ← 崖（高度5）
  5 | . . ^ ^ ^ ^ ^ ^ . . |  ← 崖（高度5）
  6 | . . . . = = . . . . |  ← 舗装路
  7 | . . . . = = . . . . |  ← 舗装路
  8 | . . . . . . . . . . |
  9 | . . . . . . . . . G |
    +---------------------+

【高度レイヤー】
      0 1 2 3 4 5 6 7 8 9
    +---------------------+
  0 | 0 0 0 0 0 0 0 0 0 0 |
  1 | 0 0 0 0 0 0 0 0 0 0 |
  2 | 0 0 0 0 0 0 0 0 0 0 |
  3 | 0 0 0 0 0 0 0 0 0 0 |
  4 | 0 0 5 5 5 5 5 5 0 0 |  ← 高度5
  5 | 0 0 5 5 5 5 5 5 0 0 |  ← 高度5
  6 | 0 0 0 0 0 0 0 0 0 0 |
  7 | 0 0 0 0 0 0 0 0 0 0 |
  8 | 0 0 0 0 0 0 0 0 0 0 |
  9 | 0 0 0 0 0 0 0 0 0 0 |
    +---------------------+
```

---

## 2. 地形コスト定数（CSV由来）

| コード | 地形 | 基本コスト | 上昇コスト/段 | 下降コスト/段 | 斜め補正 |
|:---:|:---|---:|---:|---:|---:|
| `.` | 平地 | 1.0 | 2.0 | 0.5 | 1.414 |
| `~` | 水辺 | **3.0** | 1.0 | 1.0 | 1.414 |
| `^` | 崖 | **5.0** | **10.0** | 2.0 | 1.414 |
| `=` | 舗装路 | **0.8** | 1.5 | 0.4 | 1.414 |
| `F` | 森林 | 2.0 | 1.5 | 1.0 | 1.414 |
| `#` | 壁 | ∞ | — | — | — |

---

## 3. アルゴリズム比較結果

| 指標 | Dijkstra | A* | 差異 |
|:---|:---:|:---:|:---:|
| **総コスト** | 17.400 | 17.400 | 同一（最適解） |
| **経路長** | 19ステップ | 19ステップ | 同一 |
| **展開ノード数** | 87 | 61 | A*が**29.9%削減** |
| **実行時間** | 0.501 ms | 0.320 ms | A*が高速 |

### 3.1 検証結果

- ✓ **最適性保証**: 両アルゴリズムが同一の最適コスト（17.400）を発見
- ✓ **A*効率性**: Dijkstraより29.9%少ないノード展開で探索完了
- ✓ **許容的ヒューリスティック**: マンハッタン距離 × 最小基本コストによる下界推定

---

## 4. 選択経路

### 4.1 経路座標リスト（全19ステップ）

```
Step  0: (0, 0) → Start
Step  1: (0, 1)
Step  2: (0, 2)
Step  3: (0, 3)
Step  4: (0, 4)
Step  5: (0, 5)
Step  6: (0, 6)
Step  7: (1, 6)
Step  8: (2, 6)
Step  9: (3, 6)
Step 10: (4, 6)
Step 11: (4, 7)
Step 12: (5, 7)
Step 13: (5, 8)
Step 14: (5, 9)
Step 15: (6, 9)
Step 16: (7, 9)
Step 17: (8, 9)
Step 18: (9, 9) → Goal
```

### 4.2 経路可視化

```
      0 1 2 3 4 5 6 7 8 9
    +---------------------+
  0 | S . . . F F . . . . |
  1 | @ . . . F F . . . . |
  2 | @ . ~ ~ ~ ~ ~ ~ . . |
  3 | @ . ~ ~ ~ ~ ~ ~ . . |
  4 | @ . ^ ^ ^ ^ ^ ^ . . |
  5 | @ . ^ ^ ^ ^ ^ ^ . . |
  6 | @ @ @ @ @ = . . . . |
  7 | . . . . @ @ . . . . |
  8 | . . . . . @ . . . . |
  9 | . . . . . @ @ @ @ G |
    +---------------------+

凡例: S=始点, G=終点, @=選択経路
      ~=水辺(回避), ^=崖(回避), ==舗装路
```

---

## 5. 戦術的判断分析

### 5.1 通過地形

| 地形 | 通過マス数 | 備考 |
|:---|:---:|:---|
| 平地 (`.`) | 14 | 主要経路 |
| 舗装路 (`=`) | 3 | 低コスト活用 |
| 始点 (`S`) | 1 | — |
| 終点 (`G`) | 1 | — |

### 5.2 回避判断

| 障害物 | 判定 | 理由 |
|:---|:---:|:---|
| **水辺 (`~`)** | ✓ 完全回避 | 基本コスト3.0（平地の3倍） |
| **崖 (`^`)** | ✓ 完全回避 | 上昇コスト10.0/段（高度5で+50） |

### 5.3 高度変化

| 指標 | 値 |
|:---|:---:|
| 最大上昇 | **0段** |
| 最大下降 | **0段** |

**分析**: 崖を完全に迂回したため、高度変化なしで経路を完遂。
崖を直接登る場合のコスト増分（5.0 + 10.0×5 = 55.0）を回避。

---

## 6. 座標変換ログ（論理 ↔ Isometric）

### 6.1 変換パラメータ

| パラメータ | 値 |
|:---|:---:|
| タイル幅 (tw) | 64 px |
| タイル高 (th) | 32 px |
| 高度スケール (β) | 16 px/段 |

### 6.2 変換式

```
論理→Isometric:
  X = (tw/2) × (x - y)
  Y = (th/2) × (x + y) - β × h

Isometric→論理:
  Y_adj = Y + β × h
  x = round((X/(tw/2) + Y_adj/(th/2)) / 2)
  y = round((Y_adj/(th/2) - X/(tw/2)) / 2)
```

### 6.3 経路の座標変換結果

| Step | 論理座標 | 高度 | Iso座標(float) | Iso座標(int) |
|:---:|:---:|:---:|:---:|:---:|
| 0 | (0, 0) | 0 | (0.00, 0.00) | (0, 0) |
| 1 | (0, 1) | 0 | (-32.00, 16.00) | (-32, 16) |
| 2 | (0, 2) | 0 | (-64.00, 32.00) | (-64, 32) |
| 3 | (0, 3) | 0 | (-96.00, 48.00) | (-96, 48) |
| 4 | (0, 4) | 0 | (-128.00, 64.00) | (-128, 64) |
| 5 | (0, 5) | 0 | (-160.00, 80.00) | (-160, 80) |
| 6 | (0, 6) | 0 | (-192.00, 96.00) | (-192, 96) |
| 7 | (1, 6) | 0 | (-160.00, 112.00) | (-160, 112) |
| 8 | (2, 6) | 0 | (-128.00, 128.00) | (-128, 128) |
| 9 | (3, 6) | 0 | (-96.00, 144.00) | (-96, 144) |
| 10 | (4, 6) | 0 | (-64.00, 160.00) | (-64, 160) |
| 11 | (4, 7) | 0 | (-96.00, 176.00) | (-96, 176) |
| 12 | (5, 7) | 0 | (-64.00, 192.00) | (-64, 192) |
| 13 | (5, 8) | 0 | (-96.00, 208.00) | (-96, 208) |
| 14 | (5, 9) | 0 | (-128.00, 224.00) | (-128, 224) |
| 15 | (6, 9) | 0 | (-96.00, 240.00) | (-96, 240) |
| 16 | (7, 9) | 0 | (-64.00, 256.00) | (-64, 256) |
| 17 | (8, 9) | 0 | (-32.00, 272.00) | (-32, 272) |
| 18 | (9, 9) | 0 | (0.00, 288.00) | (0, 288) |

---

## 7. 品質検証

### 7.1 往復変換精度

| 検証項目 | 測定値 | 仕様要求 | 判定 |
|:---|:---:|:---:|:---:|
| 最大誤差 X | 0.000000 px | ≤ 0.5 px | ✓ 合格 |
| 最大誤差 Y | 0.000000 px | ≤ 0.5 px | ✓ 合格 |

### 7.2 受け入れ条件（AC）検証

| AC | 内容 | 判定 |
|:---|:---|:---:|
| AC-1 | ジグザグ抑制（直線優先） | ✓ 合格 |
| AC-2 | 高所迂回妥当性 | ✓ 合格 |
| AC-3 | クリック座標逆変換精度 | ✓ 合格 |

### 7.3 テストカバレッジ

| 指標 | 値 |
|:---|:---:|
| 総テスト数 | **195件** |
| 合格数 | **195件** |
| カバレッジ | **90.68%** |
| 目標 | 80%以上 |

---

## 8. 結論

本演習において、ゲーム経路探索シミュレーターは以下の全要件を満たすことを実証した：

1. **多重重み付けコスト関数**: 地形・高度・優先度を統合した最適経路算出
2. **戦術的判断**: 水辺・崖の回避、舗装路の活用
3. **座標変換精度**: 往復変換誤差 ≤ 0.5 px の要件充足
4. **アルゴリズム効率**: A*がDijkstraより29.9%少ないノードで同一最適解を発見
5. **コスト飽和**: MAX_COST_CAP=255による境界保護

**判定: 全項目合格。システムは実戦配備可能。**

---

*報告終了*
